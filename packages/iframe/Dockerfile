ARG BASE_TAG=local
FROM snickerdoodlelabs/protocol-docker-base:${BASE_TAG} as builder

ARG DEBUG=true
ENV __DEBUG__ $DEBUG

ARG CONTROL_CHAIN_ID=31337
ENV __CONTROL_CHAIN_ID__ $CONTROL_CHAIN_ID

ARG IPFS_FETCH_BASE_URL="http://127.0.0.1:8080/ipfs"
ENV __IPFS_FETCH_BASE_URL__ $IPFS_FETCH_BASE_URL

ARG DEFAULT_INSIGHT_PLATFORM_BASE_URL="http://localhost:3006"
ENV __DEFAULT_INSIGHT_PLATFORM_BASE_URL__ $DEFAULT_INSIGHT_PLATFORM_BASE_URL

ARG DEV_CHAIN_PROVIDER_URL="http://127.0.0.1:8545"
ENV __DEV_CHAIN_PROVIDER_URL__ $DEV_CHAIN_PROVIDER_URL

ARG PORTFOLIO_POLLING_INTERVAL="7200000"
ENV __PORTFOLIO_POLLING_INTERVAL__ $PORTFOLIO_POLLING_INTERVAL

ARG TRANSACTION_POLLING_INTERVAL="21600000"
ENV __TRANSACTION_POLLING_INTERVAL__ $TRANSACTION_POLLING_INTERVAL

ARG BACKUP_POLLING_INTERVAL="21600000"
ENV __BACKUP_POLLING_INTERVAL__ $BACKUP_POLLING_INTERVAL

ARG REQUEST_FOR_DATA_POLLING_INTERVAL="300000"
ENV __REQUEST_FOR_DATA_POLLING_INTERVAL__ $REQUEST_FOR_DATA_POLLING_INTERVAL

ARG PRIMARY_INFURA_KEY=""
ENV __PRIMARY_INFURA_KEY__ $PRIMARY_INFURA_KEY

ARG PRIMARY_RPC_PROVIDER_URL=""
ENV __PRIMARY_RPC_PROVIDER_URL__ $PRIMARY_RPC_PROVIDER_URL

ARG SECONDARY_INFURA_KEY=""
ENV __SECONDARY_INFURA_KEY__ $SECONDARY_INFURA_KEY

ARG SECONDARY_RPC_PROVIDER_URL=""
ENV __SECONDARY_RPC_PROVIDER_URL__ $SECONDARY_RPC_PROVIDER_URL

ARG ALCHEMY_ARBITRUM_API_KEY=""
ENV __ALCHEMY_ARBITRUM_API_KEY__ $ALCHEMY_ARBITRUM_API_KEY

ARG ALCHEMY_ASTAR_API_KEY=""
ENV __ALCHEMY_ASTAR_API_KEY__ $ALCHEMY_ASTAR_API_KEY

ARG ALCHEMY_MUMBAI_API_KEY=""
ENV __ALCHEMY_MUMBAI_API_KEY__ $ALCHEMY_MUMBAI_API_KEY

ARG ALCHEMY_OPTIMISM_API_KEY=""
ENV __ALCHEMY_OPTIMISM_API_KEY__ $ALCHEMY_OPTIMISM_API_KEY

ARG ALCHEMY_POLYGON_API_KEY=""
ENV __ALCHEMY_POLYGON_API_KEY__ $ALCHEMY_POLYGON_API_KEY

ARG ALCHEMY_SOLANA_API_KEY=""
ENV __ALCHEMY_SOLANA_API_KEY__ $ALCHEMY_SOLANA_API_KEY

ARG ALCHEMY_SOLANA_TESTNET_API_KEY=""
ENV __ALCHEMY_SOLANA_TESTNET_API_KEY__ $ALCHEMY_SOLANA_TESTNET_API_KEY

ARG ETHERSCAN_ETHEREUM_API_KEY=""
ENV __ETHERSCAN_ETHEREUM_API_KEY__ $ETHERSCAN_ETHEREUM_API_KEY

ARG ETHERSCAN_POLYGON_API_KEY=""
ENV __ETHERSCAN_POLYGON_API_KEY__ $ETHERSCAN_POLYGON_API_KEY

ARG ETHERSCAN_AVALANCHE_API_KEY=""
ENV __ETHERSCAN_AVALANCHE_API_KEY__ $ETHERSCAN_AVALANCHE_API_KEY

ARG ETHERSCAN_BINANCE_API_KEY=""
ENV __ETHERSCAN_BINANCE_API_KEY__ $ETHERSCAN_BINANCE_API_KEY

ARG ETHERSCAN_MOONBEAM_API_KEY=""
ENV __ETHERSCAN_MOONBEAM_API_KEY__ $ETHERSCAN_MOONBEAM_API_KEY

ARG ETHERSCAN_OPTIMISM_API_KEY=""
ENV __ETHERSCAN_OPTIMISM_API_KEY__ $ETHERSCAN_OPTIMISM_API_KEY

ARG ETHERSCAN_ARBITRUM_API_KEY=""
ENV __ETHERSCAN_ARBITRUM_API_KEY__ $ETHERSCAN_ARBITRUM_API_KEY

ARG ETHERSCAN_GNOSIS_API_KEY=""
ENV __ETHERSCAN_GNOSIS_API_KEY__ $ETHERSCAN_GNOSIS_API_KEY

ARG ETHERSCAN_FUJI_API_KEY=""
ENV __ETHERSCAN_FUJI_API_KEY__ $ETHERSCAN_FUJI_API_KEY

ARG COVALENT_API_KEY=""
ENV __COVALENT_API_KEY__ $COVALENT_API_KEY

ARG MORALIS_API_KEY=""
ENV __MORALIS_API_KEY__ $MORALIS_API_KEY

ARG NFTSCAN_API_KEY=""
ENV __NFTSCAN_API_KEY__ $NFTSCAN_API_KEY

ARG POAP_API_KEY=""
ENV __POAP_API_KEY__ $POAP_API_KEY

ARG OKLINK_API_KEY=""
ENV __OKLINK_API_KEY__ $OKLINK_API_KEY

ARG ANKR_API_KEY=""
ENV __ANKR_API_KEY__ $ANKR_API_KEY

ARG BLUEZ_API_KEY=""
ENV __BLUEZ_API_KEY__ $BLUEZ_API_KEY

ARG SPACEANDTIME_API_PUBLICKEY=""
ENV __SPACEANDTIME_API_PUBLICKEY__ $SPACEANDTIME_API_PUBLICKEY
ARG SPACEANDTIME_API_PRIVATEKEY=""
ENV __SPACEANDTIME_API_PRIVATEKEY__ $SPACEANDTIME_API_PRIVATEKEY
ARG RARIBILE_API_KEY=""
ENV __RARIBILE_API_KEY__ $RARIBILE_API_KEY

ARG BLOCKVISION_API_KEY=""
ENV __BLOCKVISION_API_KEY__ $BLOCKVISION_API_KEY

RUN cd packages/iframe && yarn postCompile

FROM nginx:latest AS server

# Copy over the dist files
COPY --from=builder /build/packages/iframe/dist/bundle /usr/share/nginx/html


ARG BASE_TAG=local
FROM snickerdoodlelabs/protocol-docker-base:${BASE_TAG} as builder

ARG DEBUG=true
ENV __DEBUG__ $DEBUG

ARG CONTROL_CHAIN_ID=31337
ENV __CONTROL_CHAIN_ID__ $CONTROL_CHAIN_ID

ARG IPFS_FETCH_BASE_URL="http://127.0.0.1:8080/ipfs"
ENV __IPFS_FETCH_BASE_URL__ $IPFS_FETCH_BASE_URL

ARG DEFAULT_INSIGHT_PLATFORM_BASE_URL="http://localhost:3006"
ENV __DEFAULT_INSIGHT_PLATFORM_BASE_URL__ $DEFAULT_INSIGHT_PLATFORM_BASE_URL

ARG DEV_CHAIN_PROVIDER_URL="http://127.0.0.1:8545"
ENV __DEV_CHAIN_PROVIDER_URL__ $DEV_CHAIN_PROVIDER_URL

ARG SUPPORTED_CHAINS="1,43113,43114,137,-1,100,56,1284,42161,592,31337"
ENV __SUPPORTED_CHAINS__ $SUPPORTED_CHAINS

ARG PORTFOLIO_POLLING_INTERVAL="7200000"
ENV __PORTFOLIO_POLLING_INTERVAL__ $PORTFOLIO_POLLING_INTERVAL

ARG TRANSACTION_POLLING_INTERVAL="21600000"
ENV __TRANSACTION_POLLING_INTERVAL__ $TRANSACTION_POLLING_INTERVAL

ARG BACKUP_POLLING_INTERVAL="21600000"
ENV __BACKUP_POLLING_INTERVAL__ $BACKUP_POLLING_INTERVAL

ARG REQUEST_FOR_DATA_POLLING_INTERVAL="300000"
ENV __REQUEST_FOR_DATA_POLLING_INTERVAL__ $REQUEST_FOR_DATA_POLLING_INTERVAL

RUN cd packages/iframe && yarn postCompile

FROM nginx:latest AS server

# Copy over the dist files
COPY --from=builder /build/packages/iframe/dist/bundle /usr/share/nginx/html

